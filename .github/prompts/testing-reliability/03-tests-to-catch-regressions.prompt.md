Write tests designed to catch regressions if the described code is refactored.

Instructions
- Focus on externally observable behavior and contracts (inputs/outputs/side effects), not implementation details.
- Include representative “golden path” tests plus critical edge cases.
- Add tests for failure behavior (errors, retries, fallback paths) where relevant.

Output
- A set of tests (or a test plan with concrete cases) that would fail if behavior changes unintentionally.
